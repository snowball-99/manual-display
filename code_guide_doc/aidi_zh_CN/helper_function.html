<!doctype html>
<html class="no-js" lang="zh-CN" data-content_root="">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="索引" href="genindex.html" /><link rel="search" title="搜索" href="search.html" /><link rel="next" title="常用函数列表" href="common_function.html" /><link rel="prev" title="区域计算脚本编辑指南" href="code_introduction/region_calculation.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.09.10 -->
        <title>内置函数模板说明 - AIDI Script Editing Guidance</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo.css?digest=369552022d0b975c8e74270ce6eabe0fb7978f24" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="index.html"><div class="brand">AIDI Script Editing Guidance</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="_static/aidi-logo-cb.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">AIDI Script Editing Guidance</span>
  
</a><form class="sidebar-search-container" method="get" action="search.html" role="search">
  <input class="sidebar-search" placeholder="搜索" name="q" aria-label="搜索">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="getting_start.html">脚本编辑器入门指南</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="code_introduction/index.html">代码编辑指南</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 代码编辑指南</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="code_introduction/intergration_classify.html">综合评判脚本编辑指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_introduction/view_transform.html">视图转换脚本编辑指南</a></li>
<li class="toctree-l2"><a class="reference internal" href="code_introduction/region_calculation.html">区域计算脚本编辑指南</a></li>
</ul>
</li>
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">内置函数模板说明</a></li>
<li class="toctree-l1"><a class="reference internal" href="common_function.html">常用函数列表</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="cpp_api/index.html">C++ API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of C++ API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/namespace.html">Namespace</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/common.html">Common</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/props.html">Property Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/image.html">Image type and image algorithm interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/geometry.html">Geometry Structure and Algorithm</a></li>
<li class="toctree-l2"><a class="reference internal" href="cpp_api/excepts.html">Exception Handling</a></li>
</ul>
</li>
</ul>

</div></div><script>
    // Execute when the page is loaded.
    window.onload = function () {
        // Get the URL of the current directory.
        var currentDirectory = window.location.pathname;

        // Original language set.
        var langs = ["en_US", "zh_CN", "zh_TW"]
        var origin_lang;

        for (var i = 0; i < langs.length; i++) {
            var lang = langs[i];
            if (currentDirectory.includes(lang + '/')) {
                origin_lang = lang;
                break
            }
        }

        // Find all links with 'dynamic-link' class.
        var links = document.querySelectorAll('.dynamic-link');

        // Updating the 'href' attribute of each link.
        links.forEach(function (link) {
            var target_lang = link.getAttribute('data-lang');
            link.href = currentDirectory.replace(origin_lang + '/', target_lang + '/');
        });
    };
</script>

<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <div class="rst-other-versions">
        
        <dl>
            <dt>Languages</dt>
            
            <dd><a class="dynamic-link" data-lang="en_US">en_US</a></dd>
            
            <dd><a class="dynamic-link" data-lang="zh_CN">zh_CN</a></dd>
            
            <dd><a class="dynamic-link" data-lang="zh_TW">zh_TW</a></dd>
            
        </dl>
        
        <br>
        </dl>
    </div>
</div>
      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="instructions-for-built-in-function-templates">
<h1>内置函数模板说明<a class="headerlink" href="#instructions-for-built-in-function-templates" title="此标题的永久链接">#</a></h1>
<section id="region-partitioning-function-split-poly">
<h2>区域分块函数Split Poly<a class="headerlink" href="#region-partitioning-function-split-poly" title="此标题的永久链接">#</a></h2>
<section id="definition-of-details">
<h3>细节定义<a class="headerlink" href="#definition-of-details" title="此标题的永久链接">#</a></h3>
<ul class="simple">
<li><p>功能：将多个Polygon切分为指定大小的切片，多用于视图转换器脚本中为后续算法工具生成大小一致的视图以实现输入尺寸的归一化</p></li>
<li><dl class="simple">
<dt>输入：</dt><dd><ul>
<li><p>polys：目标切分的多边形</p></li>
<li><p>tg_width: 目标切块宽度</p></li>
<li><p>tg_height: 目标切块高度</p></li>
<li><p>image_width=0: 原始图片宽度</p></li>
<li><p>image_height=0: 原始图片高度</p></li>
<li><p>overlap_width=0: 目标切块之间的横向间隔,默认为0</p></li>
<li><p>overlap_height=0: 目标切块之间的纵向间隔,默认为0</p></li>
<li><p>discard_out_range=False: 是否舍弃超出部分,如果为False则会使用掩膜填充超出部分区域,默认为False</p></li>
<li><p>is_segment_mode=False: 前序模块是否为分割模块,如果为True则会根据最小外接矩形自行计算角度并归一化,最后角度范围在(-90,90]</p></li>
<li><p>enable_auto_mask=False: 是否启用自动掩膜,如果为True则会在每个目标切块中绘制对应缺陷形状的掩膜</p></li>
<li><p>erode_dilate_value=0: 自动掩膜腐蚀膨胀参数,大于0代表膨胀,小于0代表腐蚀,默认为0</p></li>
<li><p>reverse_mask=False: 是否反选自动掩膜,如果启用自动掩膜时这一参数为False,则会将掩膜反选</p></li>
<li><p>with_angle=False: 是否根据多边形角度切块，默认为False</p></li>
<li><p>iou_thres=0.8: 切块之间去重阈值，当两个切块交叠率大于此阈值时仅保留一个</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>输出：</dt><dd><ul>
<li><p>view_list：视图列表</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>详细使用场景请参考 <a class="reference internal" href="code_introduction/view_transform.html"><span class="doc">视图转换脚本编辑指南</span></a> 中基础示例章节</p></li>
</ul>
</section>
</section>
<section id="relative-grayscale-measurement-function">
<h2>相对灰度测量函数Relative Grayscale<a class="headerlink" href="#relative-grayscale-measurement-function" title="此标题的永久链接">#</a></h2>
<img alt="_images/cs_help_relative_grayscale_description.png" src="_images/cs_help_relative_grayscale_description.png" />
</section>
<section id="weld-bead-width-measurement-function">
<h2>焊道宽度测量函数Bead Width<a class="headerlink" href="#weld-bead-width-measurement-function" title="此标题的永久链接">#</a></h2>
<section id="measurement-instructions">
<h3>测量说明<a class="headerlink" href="#measurement-instructions" title="此标题的永久链接">#</a></h3>
<p>采用线段组定义测量位置，用一组线段来表示测量位置，如下所示，红色线段表示测量位置，与闭合图形的交点间的距离作为测量的宽度。对每个区域进行测量，测量的值为该区域所有测量位置的最大值和最小值，如果某个区域没有定义测量位置，则其最大宽度会输出为-1</p>
<img alt="_images/cs_help_measurement_instructions.png" src="_images/cs_help_measurement_instructions.png" />
</section>
<section id="id1">
<h3>细节定义<a class="headerlink" href="#id1" title="此标题的永久链接">#</a></h3>
<ul>
<li><p>输入：AI分割结果（<code class="docutils literal notranslate"><span class="pre">MultiPolygon2f</span></code>），以及所需测量的位置（<code class="docutils literal notranslate"><span class="pre">MultiSegment2f</span></code>）</p></li>
<li><p>输出：所有测量位置处的宽度的最大值及最小值</p></li>
<li><p>宽度定义的细节:</p>
<blockquote>
<div><ul class="simple">
<li><p>宽度定义：线段与多边形交点间的距离（正常情况，如下图绿色）</p></li>
<li><p>线段与多边形无交点：忽略此测量位置（如下图红色虚线）</p></li>
<li><p>线段与同一多边形有奇数个交点时：忽略此测量位置（如下图红色实线）</p></li>
<li><p>线段与多边形有大于2个交点时：返回最外两点的距离作为宽度，或忽略（暂时选择忽略）（此种方法仍存在失败的情况，如下图紫色，此类情况仍存在错误）</p></li>
<li><p>计算线段与多边形交点时只考虑多边形的外环</p></li>
<li><p>存在N个交点时，因为无法区分是否正常，忽略此测量位置</p></li>
<li><p>综上：即只保留线段与多边形只存在两个交点，且线段两端点均在多边形外的场景。</p></li>
<li><p>下图中只有绿色线段位置测量有效。</p></li>
</ul>
<img alt="_images/cs_help_effective_measurement.png" src="_images/cs_help_effective_measurement.png" />
</div></blockquote>
</li>
</ul>
</section>
<section id="example-code">
<h3>示例代码<a class="headerlink" href="#example-code" title="此标题的永久链接">#</a></h3>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The region_list segmentation model segments the weld bead area, which can be obtained by referring to the following section: doc: &#39;Comprehensive Judgment Script Editing Guide&lt;integration_classify&gt;&#39;</span>
<span class="n">region_list</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># measure_segs represents the measurement position of the weld bead. If the measurement position is fixed, the measurement position can be directly defined in this script (as currently defined, three measurement positions are defined). If each image is different, it should be passed in as a parameter</span>
<span class="n">measure_segs</span> <span class="o">=</span> <span class="p">[</span><span class="n">geo</span><span class="o">.</span><span class="n">LineString2f</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">464</span><span class="p">,</span> <span class="mi">461</span><span class="p">),</span> <span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">464</span><span class="p">,</span> <span class="mi">651</span><span class="p">)),</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">LineString2f</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">757</span><span class="p">,</span> <span class="mi">441</span><span class="p">),</span> <span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">788</span><span class="p">,</span> <span class="mi">852</span><span class="p">)),</span>
                <span class="n">geo</span><span class="o">.</span><span class="n">LineString2f</span><span class="p">(</span><span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">821</span><span class="p">,</span> <span class="mi">527</span><span class="p">),</span> <span class="n">geo</span><span class="o">.</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">887</span><span class="p">,</span> <span class="mi">852</span><span class="p">))]</span>

<span class="k">def</span> <span class="nf">pass_func</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">min_width</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine whether the maximum and minimum widths of the weld bead width are NG</span>
<span class="sd">    : param max_width: The maximum width of the weld bead, which is the effective width when it is a positive number, and -1 indicates that the width measurement result is invalid</span>
<span class="sd">    : param min_width: The minimum width of the weld bead</span>
<span class="sd">            &quot;&quot;&quot;</span>
    <span class="c1"># Please define the judgment criteria based on your needs here</span>
    <span class="k">return</span> <span class="n">max_width</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">min_width</span> <span class="o">&lt;</span> <span class="mi">300</span>


<span class="c1">#Measure_segs is a group of decision line segments passed in by the user</span>
<span class="c1">#TODO pass_func -&gt;bool, a user-defined judgment function that determines whether the current weld bead is qualified</span>
<span class="k">def</span> <span class="nf">measure_weld</span><span class="p">(</span><span class="n">region_list</span><span class="p">,</span> <span class="n">measure_segs</span><span class="p">,</span> <span class="n">pass_func</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    measure weld region width(max_width and min_width) at measure_segs positino</span>
<span class="sd">    : param regionlist: The weld bead area inferred by AI, only considering the outer ring of the weld bead during measurement</span>
<span class="sd">    : param measures_segs: represents the group of line segments that need to be measured, list (LineString2f), each line segment (represented by LineString2f) represents a measurement position, and each line segment can only contain two points</span>
<span class="sd">    : param pass_fun: Determination function for weld bead width</span>
<span class="sd">    : return: The maximum and minimum values of the weld bead width in all regions are represented as follows: [(max, min), (max, min),...], with a list length equal to regions_list. For each weld bead area, the maximum width is -1 if a measurement area fails</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">:</span>
        <span class="n">ring</span> <span class="o">=</span> <span class="n">region</span><span class="o">.</span><span class="n">polygon</span><span class="p">()</span><span class="o">.</span><span class="n">outer</span>
        <span class="n">min_width</span><span class="p">,</span> <span class="n">max_width</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">seg</span> <span class="ow">in</span> <span class="n">measure_segs</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seg</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># assert(len(seg) == 2, &#39;Each measure segment line must only have 2 points&#39;)</span>
            <span class="n">insects</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">ring</span><span class="p">,</span> <span class="n">seg</span><span class="p">)</span>
            <span class="c1"># There can only be two intersections</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">insects</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># Both points need to be outside the area</span>
                <span class="k">if</span> <span class="n">geo</span><span class="o">.</span><span class="n">covered_by</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ring</span><span class="p">)</span> <span class="ow">or</span> <span class="n">geo</span><span class="o">.</span><span class="n">covered_by</span><span class="p">(</span><span class="n">seg</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ring</span><span class="p">):</span>
                    <span class="k">continue</span>
                <span class="n">dist</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">insects</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">insects</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                <span class="n">max_width</span><span class="p">,</span> <span class="n">min_width</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">dist</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">min_width</span><span class="p">,</span> <span class="n">dist</span><span class="p">)</span>
        <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">max_width</span><span class="p">,</span> <span class="n">min_width</span><span class="p">))</span>

    <span class="c1"># Call your judgment rule to determine if the width is OK</span>
    <span class="k">for</span> <span class="n">max_w</span><span class="p">,</span> <span class="n">min_w</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">pass_func</span><span class="p">(</span><span class="n">max_w</span><span class="p">,</span> <span class="n">min_w</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
<section id="region-deduplication-function-nms-by-center-distance">
<h2>区域去重函数Nms By Center Distance<a class="headerlink" href="#region-deduplication-function-nms-by-center-distance" title="此标题的永久链接">#</a></h2>
<section id="id2">
<h3>细节定义<a class="headerlink" href="#id2" title="此标题的永久链接">#</a></h3>
<ul class="simple">
<li><p>功能：通过区域中心距离完成区域的去重，两个区域中心距离小于center_dis时仅保留其中一个。</p></li>
<li><dl class="simple">
<dt>输入：</dt><dd><ul>
<li><p>polys：目标切分的多边形</p></li>
<li><p>center_dis：两个区域中心的距离</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>输出：</dt><dd><ul>
<li><p>ply_region_list：区域列表</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</section>
<section id="id3">
<h3>示例代码<a class="headerlink" href="#id3" title="此标题的永久链接">#</a></h3>
<blockquote>
<div><div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">nms_by_center_dis</span><span class="p">(</span><span class="n">region_list</span><span class="p">,</span> <span class="n">center_dis</span><span class="p">):</span>
    <span class="n">copy_region_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">region_list</span><span class="p">:</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">polygon</span><span class="p">())</span>
        <span class="n">copy_region_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">score</span><span class="p">()),</span> <span class="n">region</span><span class="p">))</span>
    <span class="n">copy_region_list</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">copy_region_list</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">region_id_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">center_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">region_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">region_score</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="n">copy_region_list</span><span class="p">:</span>
        <span class="n">region_id_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">region_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="n">region_score</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">score</span><span class="p">())</span>
        <span class="n">center</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="n">region</span><span class="o">.</span><span class="n">polygon</span><span class="p">())</span>
        <span class="n">center_list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">center</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">center</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="n">ply_region_list</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">PolygonRegionList</span><span class="p">()</span>
    <span class="n">center_list_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">center_list</span><span class="p">)</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">center_list_arr</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">-</span> <span class="n">center_list_arr</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">keep_id_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">region_id_list</span><span class="p">)):</span>
        <span class="n">keep_i</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">for</span> <span class="n">keep_id</span> <span class="ow">in</span> <span class="n">keep_id_list</span><span class="p">:</span>
            <span class="c1"># If the center distance is less than center-dis, it is considered overlapping</span>
            <span class="k">if</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">keep_id</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">center_dis</span><span class="p">:</span>
                <span class="n">keep_i</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">break</span>
        <span class="k">if</span> <span class="n">keep_i</span><span class="p">:</span>
            <span class="n">ply_region_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">region_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">keep_id_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">ply_region_list</span>
</pre></div>
</div>
</div></blockquote>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="common_function.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">常用函数列表</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="code_introduction/region_calculation.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">区域计算脚本编辑指南</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2017-2024, Aqrose-Technology Co., Ltd. All rights reserved.
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">内置函数模板说明</a><ul>
<li><a class="reference internal" href="#region-partitioning-function-split-poly">区域分块函数Split Poly</a><ul>
<li><a class="reference internal" href="#definition-of-details">细节定义</a></li>
</ul>
</li>
<li><a class="reference internal" href="#relative-grayscale-measurement-function">相对灰度测量函数Relative Grayscale</a></li>
<li><a class="reference internal" href="#weld-bead-width-measurement-function">焊道宽度测量函数Bead Width</a><ul>
<li><a class="reference internal" href="#measurement-instructions">测量说明</a></li>
<li><a class="reference internal" href="#id1">细节定义</a></li>
<li><a class="reference internal" href="#example-code">示例代码</a></li>
</ul>
</li>
<li><a class="reference internal" href="#region-deduplication-function-nms-by-center-distance">区域去重函数Nms By Center Distance</a><ul>
<li><a class="reference internal" href="#id2">细节定义</a></li>
<li><a class="reference internal" href="#id3">示例代码</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/scripts/furo.js"></script>
    <script src="_static/tabs.js"></script>
    <script src="_static/translations.js"></script>
    </body>
</html>